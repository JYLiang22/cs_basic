- [没有accept也可以建立TCP连接](#没有accept也可以建立tcp连接)
- [三次握手的细节分析](#三次握手的细节分析)
  - [半连接队列、全连接队列是什么](#半连接队列全连接队列是什么)
  - [为什么半连接队列要设计成哈希表](#为什么半连接队列要设计成哈希表)
  - [全连接队列满了会怎么样](#全连接队列满了会怎么样)
  - [半连接队列要是满了会怎么样](#半连接队列要是满了会怎么样)


# 没有accept也可以建立TCP连接
通过写代码抓包分析，这个细节之前在学网络编程的时候也学到过，回去看看结合理解。


# 三次握手的细节分析


## 半连接队列、全连接队列是什么
1. 结合socket网络编程重新介绍这两个队列和状态变换
2. 介绍了accept的作用是什么
3. 进一步介绍了两个队列的不同之处：虽然都叫队列，但其实全连接队列（icsk_accept_queue）是个链表，而半连接队列（syn_table）是个哈希表。


## 为什么半连接队列要设计成哈希表
1. 每个监听socket都有各自的全连接队列，所以从全连接队列取的连接就是自己所监听的：它里面放的都是已经建立完成的连接，这些连接正等待被取走。而服务端取走连接的过程中，并不关心具体是哪个连接，只要是个连接就行，所以直接从队列头取就行了。
2. 半连接队列不完整，要根据四元组区分


## 全连接队列满了会怎么样
1. 这个之前也讲过了，还是要从Linux网络编程的参数分析，所以这些参数该了解的还是要了解
2. 如果队列满了，服务端还收到客户端的第三次握手ACK，默认当然会丢弃这个ACK。但除了丢弃之外，还有一些附带行为，这会受 tcp_abort_on_overflow 参数的影响


## 半连接队列要是满了会怎么样
1. 一般是丢弃，但这个行为可以通过 tcp_syncookies 参数去控制
2. cookies方案为什么不直接取代半连接队列：ACK攻击