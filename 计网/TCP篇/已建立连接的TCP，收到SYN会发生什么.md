- [问题引入](#问题引入)
- [客户端syn报文里的端口号与历史连接不相同](#客户端syn报文里的端口号与历史连接不相同)
- [客户端syn报文里的端口号与历史连接相同](#客户端syn报文里的端口号与历史连接相同)


# 问题引入
一个已经建立的 TCP 连接，客户端中途宕机了，而服务端此时也没有数据要发送，一直处于 Established 状态，客户端恢复后，向服务端建立连接，此时服务端会怎么处理？<br>
TCP连接是由**四元组**唯一确认的，那么在这个场景下，客户端ip、服务端ip以及目的端口都没有变化，所以怎么处理取决于源端口是否和上一次的源端口一样！


# 客户端syn报文里的端口号与历史连接不相同
很明显会通过三次握手建立新连接！<br>
如何处理旧连接？
1. 服务端发送数据：回RST
2. 不发送数据：保活机制


# 客户端syn报文里的端口号与历史连接相同
当四元组相同时，会检查序列号是否是服务端所期待的，即序列号是否在接收窗口内！<br>
所以最终结果是三次握手失败，服务端会释放连接。