- [基础知识](#基础知识)
- [整体概述](#整体概述)
- [定时方法与信号通知流程](#定时方法与信号通知流程)
  - [基础API](#基础api)
  - [信号通知流程](#信号通知流程)
    - [统一事件源](#统一事件源)
    - [信号处理机制](#信号处理机制)
  - [代码实现](#代码实现)
- [定时器及其容器设计与定时任务的处理](#定时器及其容器设计与定时任务的处理)
  - [定时器设计](#定时器设计)
  - [定时器容器设计](#定时器容器设计)
  - [定时任务处理函数](#定时任务处理函数)
  - [使用定时器](#使用定时器)


# 基础知识

这里介绍了四个概念：非活跃、定时事件、定时器和定时器容器，可以结合计网和操作系统理解。<br>


# 整体概述

把上面介绍的概念都结合起来了：服务器主循环为每一个连接创建一个定时器，并对每个连接进行定时。另外，利用升序时间链表容器将所有定时器串联起来，若主循环接收到定时通知，则在链表中依次执行定时任务。<br>

本项目使用SIGALRM进行定时<br>

定时器处理非活动连接模块，主要分为两部分：
1. 定时方法与信号通知流程
2. 定时器及其容器设计与定时任务的处理


# 定时方法与信号通知流程


## 基础API

介绍以下API：sigaction结构体、sigaction函数、sigfillset函数、SIGALRM信号、SIGTERM信号、alarm函数、socketpair函数、send函数。这里不多赘述，用到的时候结合代码理解。<br>


## 信号通知流程

要清楚Linux采用异步处理机制处理信号，信号处理函数和当前进程是两条不同的执行路线。详细参考信号处理机制部分内容。<br>

一般的信号处理函数需要处理该信号对应的逻辑，当该逻辑比较复杂时，信号处理函数执行时间过长，会导致信号屏蔽太久。<br>

这里的解决方案是，信号处理函数仅仅发送信号通知程序主循环，将信号对应的处理逻辑放在程序主循环中，由主循环执行信号对应的逻辑代码。<br>


### 统一事件源

统一事件源，是指将信号事件与其他事件一样被处理。这里使用管道将信号传递给主循环，使用I/O复用系统监听管道的可读事件。<br>


### 信号处理机制

感觉特别像操作系统的中断处理机制，可以结合操作系统的进程管理部分理解。<br>


## 代码实现

感觉就是把信号处理机制部分对应实现了，所以重点结合信号处理机制和信号通知流程理解。<br>


# 定时器及其容器设计与定时任务的处理

这部分主要以代码分析为主，分析每一部分的框架和具体内容。<br>

感觉不是很难，只要理解框架、注意细节就好了。<br>


## 定时器设计


## 定时器容器设计


## 定时任务处理函数


## 使用定时器
